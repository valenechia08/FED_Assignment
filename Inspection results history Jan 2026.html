<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regulatory&Complianceinfo</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Kodchasan:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet"
    />

    <link rel="stylesheet" href="Master_page_stylesheet.css" />

    <style>
      * {
        box-sizing: border-box;
        font-family: system-ui, -apple-system, sans-serif;
      }

      :root {
        --table-columns: 90px 1.2fr 1.4fr 100px;
      }

      @media (max-width: 700px) {
        :root {
          --table-columns: 70px 1fr 1fr 70px;
        }
      }
      body {
        margin: 0;
        background: #fff;
      }

      .contents {
        max-width: 1000px;
        margin: auto;
        padding: 1rem;
      }

      .page-header h1 {
        margin: 0 0 1rem;
        font-size: 1.4rem;
      }

      .content {
        background: #fdeee6;
        border-radius: 12px;
        padding: 1rem;
        overflow-x: auto;
      }

      /* Table header */
      .table-header {
        display: grid;
        grid-template-columns: 213px 2.35fr 1.4fr 100px;
        font-weight: 600;
        padding: 0.5rem 0;
        gap: 1rem;
      }

      /* List */
      .stall-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      /* Card */
      .stall-card {
        display: grid;
        grid-template-columns: 90px 1.2fr 1.4fr 100px;
        align-items: center;
        gap: 1rem;
        width: 100%;
      }

      /* Image */
      .stall-card img {
        width: 90px;
        height: 90px;
        object-fit: cover;
        border-radius: 8px;
      }

      /* Text */
      .stall-name {
        font-weight: 600;
      }

      .ratings {
        font-size: 0.9rem;
        line-height: 1.4;
      }

      /* Grade */
      .grade {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.2rem;
      }

      .grade-a {
        background: #d9534f;
      }

      .grade-b {
        background: #5cb85c;
      }

      .grade-c {
        background: #f0ad4e;
      }
      /* Responsive */
      @media (max-width: 700px) {
        .table-header,
        .stall-card {
          display: grid;
          grid-template-columns: var(--table-columns);
          gap: 1rem;
        }

        .table-header {
          font-weight: 600;
          padding: 0.5rem 0;
        }

        .stall-card {
          align-items: center;
        }
      }   


    </style> 
</head>

<body>
   <main class="container">
      <nav class="navrectangle">
      <div class="container">
        <div class="top-nav">
          <div class="nav-left">
            <div class="Logo">
              <img src="/images/ShiokLah(cropped).jpeg" alt="Logo" />
            </div>
          </div>

          <div class="nav-center">
            <ul class="menu" id="menu">
              <li class="menu-item">

              <li class="menu-item">
                <a href="#">Profile</a>
                <ul class="dropdown">
                  <li><a href="UserProfile.html">Overview</a></li>
                  <li><a href="Analytics.html">Analytics & Reporting</a></li>
                </ul>
              </li>

              <li class="menu-item">
                <a href="SelectRole.html">Log Out</a>
              </li>
            </ul>
          </div>

          <div class="nav-right">
            <div class="hamburger" id="hamburger">
              <div></div><div></div><div></div>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <hr class="Nav-line" />
    
      <main class="contents">
  <header class="page-header">
    <div class="header-row">
      <div class="title-block">
        <h1>8 Jan 2026, 11am</h1>
      </div>
    </div>
  </header>

  <main class="content">
    <div class="table-header">
      <span>Stall Pic</span>
      <span>Stall Name</span>
      <span>Ratings</span>
      <span>Hygiene Grade</span>
    </div>

    <section class="stall-list">
      <!-- Stall item -->
      <!-- <article class="stall-card">
        <img src="images/Banana Leaf Nasi Lemak Picture.jpg" alt="Banana Leaf Nasi Lemak">
        <div class="stall-name">Banana Leaf<br>Nasi Lemak</div>
        <div class="ratings">
          Cleanliness - 80%<br>
          Handling - 85%<br>
          Efficiency - 82%<br>
          <strong>Total - 82.3%</strong>
        </div>
        <div class="grade grade-b">B</div>
      </article>

      <article class="stall-card">
        <img src="images/Boon Lay Fried Carrot Cake & Kway Teow Mee Picture.jpg" alt="Boon Lay Fried Carrot Cake">
        <div class="stall-name">Boon Lay Fried<br>Carrot Cake &amp;<br>Kway Teow Mee</div>
        <div class="ratings">
          Cleanliness - 86%<br>
          Handling - 83%<br>
          Efficiency - 90%<br>
          <strong>Total - 86.3%</strong>
        </div>
        <div class="grade grade-a">A</div>
      </article>

      <article class="stall-card">
        <img src="images/Boon Lay Lu Wei Picture.jpg" alt="Boon Lay Lu Wei">
        <div class="stall-name">Boon Lay Lu Wei</div>
        <div class="ratings">
          Cleanliness - 81%<br>
          Handling - 84%<br>
          Efficiency - 84%<br>
          <strong>Total - 83%</strong>
        </div>
        <div class="grade grade-b">B</div>
      </article>

      <article class="stall-card">
        <img src="images/I.Mohamed Ismail Food Stall Picture.jpg" alt="I. Mohamed Ismail Food Stall">
        <div class="stall-name">I. Mohamed Ismail<br>Food Stall</div>
        <div class="ratings">
          Cleanliness - 82%<br>
          Handling - 78%<br>
          Efficiency - 74%<br>
          <strong>Total - 78%</strong>
        </div>
        <div class="grade grade-b">B</div>
      </article>

      <article class="stall-card">
        <img src="images/Big Daddy's Chicken & Noodle Picture.webp" alt="Big Daddy's Chicken & Noodle Stall">
        <div class="stall-name">Big Daddy's<br>Chicken &amp;<br>Noodle Stall</div>
        <div class="ratings">
          Cleanliness - 89%<br>
          Handling - 84%<br>
          Efficiency - 77%<br>
          <strong>Total - 83.3%</strong>
        </div>
        <div class="grade grade-b">B</div>
      </article> -->

    </section>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,   
        push,
        set,
        get,
        update,
        remove,
        child,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCoYoGP4NYJPHqA-kV_swajQ4LSQYdyWV4",
        authDomain: "grp3fedapp.firebaseapp.com",
        databaseURL:
          "https://grp3fedapp-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "grp3fedapp",
        storageBucket: "grp3fedapp.firebasestorage.app",
        messagingSenderId: "791146838729",
        appId: "1:791146838729:web:446baee191feeb036e2b18",
      };

      /* ================================
        Initialize Firebase
      ================================ */
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      const rootRef = ref(db, "/");

      // âœ… Real-time listen to ALL data
      onValue(ref(db, "/"), (snapshot) => {
        console.log("REAL-TIME DATA:", snapshot.val());
      });


      function calculateAverage(values) {
        const nums = Object.values(values).filter(v => typeof v === "number");
        if (!nums.length) return null;
        return (nums.reduce((a, b) => a + b, 0) / nums.length);
      }

      function getHygieneGrade(avg) {
        if (avg >= 85) return "A";
        if (avg >= 75) return "B";
        if (avg >= 65) return "C";
        return "D";
      }

      function getGradeClass(grade) {
        return `grade-${grade.toLowerCase()}`;
      }

      function renderStalls(stalls) {
  const list = document.querySelector(".stall-list");
  list.innerHTML = "";

  Object.entries(stalls).forEach(([stallName, stall]) => {

    const ratings = {
      cleanliness: stall.cleanliness,
      handling: stall.handling,
      efficiency: stall.efficiency
    };

    const avg = calculateAverage(ratings);
    const avgPercent = avg !== null ? Math.round(avg * 100) : null;
    const grade = avgPercent !== null ? getHygieneGrade(avgPercent) : "";

    const ratingLines = [
      `Cleanliness - ${typeof ratings.cleanliness === "number" ? Math.round(ratings.cleanliness * 100) + "%" : "N/A"}`,
      `Handling - ${typeof ratings.handling === "number" ? Math.round(ratings.handling * 100) + "%" : "N/A"}`,
      `Efficiency - ${typeof ratings.efficiency === "number" ? Math.round(ratings.efficiency * 100) + "%" : "N/A"}`
    ];

    if (avgPercent !== null) {
      ratingLines.push(`<strong>Total - ${avgPercent}%</strong>`);
    }

    const card = document.createElement("article");
    card.className = "stall-card";

    card.innerHTML = `
      <img 
        src="${stall.image || "images/placeholder.jpg"}" 
        alt="${stallName}"
        style="cursor:pointer"
        onclick="window.location.href='stallForm.html?stall=${encodeURIComponent(stallName)}'"
      >
      <div class="stall-name">${stallName}</div>
      <div class="ratings">${ratingLines.join("<br>")}</div>
      <div class="grade ${grade ? getGradeClass(grade) : ""}">
        ${grade || ""}
      </div>
    `;

    list.appendChild(card);
  });
}

      const stallsRef = ref(db, "stalls");
      onValue(stallsRef, snapshot => {
        if (snapshot.exists()) {
          renderStalls(snapshot.val());
        }
      });
</script>

  </main>
</main>
