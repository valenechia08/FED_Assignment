<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stall Inspection Results Form</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #fdeee6;
    margin: 0;
    padding: 1rem;
  }

  .card {
    max-width: 420px;
    margin: auto;
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
  }

  h2 {
    margin-top: 0;
    text-align: center;
  }

  label {
    display: block;
    margin-top: 1rem;
    font-weight: 600;
  }

  input {
    width: 100%;
    padding: 0.6rem;
    margin-top: 0.4rem;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  button {
    width: 100%;
    margin-top: 1rem;
    padding: 0.7rem;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
  }

  .calc-btn { background: #5cb85c; color: white; }
  .submit-btn { background: #0275d8; color: white; }

  .grade-display {
    margin-top: 1rem;
    text-align: center;
    font-size: 1.4rem;
    font-weight: bold;
  }

  .inspection-layout {
  display: grid;
  grid-template-columns: 140px 1fr;
  gap: 1.2rem;
  align-items: start;
}

.stall-image img {
  width: 140px;
  height: 140px;
  object-fit: cover;
  border-radius: 10px;
}

.grade-display {
  margin-top: 1rem;
  padding: 1rem;
  border-radius: 12px;
  font-size: 1.6rem;
  font-weight: 700;
  text-align: center;
  color: white;
}

.stall-left {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.stall-title {
  margin: 0 0 0.5rem 0;
  text-align: center;
}

/* Desktop layout stays side-by-side */
.inspection-layout {
  display: grid;
  grid-template-columns: 160px 1fr;
  gap: 1.2rem;
  align-items: start;
}

/* ðŸ“± Mobile layout */
@media (max-width: 600px) {
  .inspection-layout {
    grid-template-columns: 1fr;
  }

  .stall-left {
    order: 1;
  }

  .inspection-content {
    order: 2;
  }
}

/* Grade colors */
.grade-a { background: #d9534f; }
.grade-b { background: #5cb85c; }
.grade-c { background: #f0ad4e; }
.grade-d { background: #777; }
</style>
</head>

<body>

<div class="card inspection-layout">
  <!-- LEFT: stall title + image -->
  <div class="stall-left">
    <h2 id="stallTitle" class="stall-title">Stall</h2>
    <div class="stall-image">
      <img id="stallImage" src="images/placeholder.jpg" alt="Stall image">
    </div>
  </div>

  <!-- RIGHT: form + grade -->
  <div class="inspection-content">
    <h2>Edit results</h2>

    <label>Cleanliness (%)</label>
    <input type="number" id="cleanliness" min="0" max="100">

    <label>Handling (%)</label>
    <input type="number" id="handling" min="0" max="100">

    <label>Efficiency (%)</label>
    <input type="number" id="efficiency" min="0" max="100">

    <div id="gradeResult" class="grade-display"></div>

    <button class="submit-btn" onclick="submitData()">Done</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,   
        push,
        set,
        get,
        update,
        remove,
        child,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCoYoGP4NYJPHqA-kV_swajQ4LSQYdyWV4",
        authDomain: "grp3fedapp.firebaseapp.com",
        databaseURL:
          "https://grp3fedapp-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "grp3fedapp",
        storageBucket: "grp3fedapp.firebasestorage.app",
        messagingSenderId: "791146838729",
        appId: "1:791146838729:web:446baee191feeb036e2b18",
      };

      /* ================================
        Initialize Firebase
      ================================ */
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      const rootRef = ref(db, "/");

      // âœ… Real-time listen to ALL data
      onValue(ref(db, "/"), (snapshot) => {
        console.log("REAL-TIME DATA:", snapshot.val());
      });

  const params = new URLSearchParams(window.location.search);
  const stallName = params.get("stall");

  document.getElementById("stallTitle").textContent = stallName;

  const stallRef = ref(db, `stalls/${stallName}`);
get(stallRef).then(snapshot => {
  if (snapshot.exists()) {
    const stall = snapshot.val();
    if (stall.image) {
      document.getElementById("stallImage").src = stall.image;
    }
  }
});


  function getGrade(avg) {
    if (avg >= 85) return "A";
    if (avg >= 75) return "B";
    if (avg >= 65) return "C";
    return "D";
  }

  function updateGrade() {
  const c = Number(cleanliness.value);
  const h = Number(handling.value);
  const e = Number(efficiency.value);

  if ([c, h, e].some(v => isNaN(v))) {
    gradeResult.textContent = "";
    gradeResult.className = "grade-display";
    return;
  }

  const avg = (c + h + e) / 3;
  const grade = getGrade(avg);

  gradeResult.textContent = `${grade}`;
  gradeResult.className = `grade-display grade-${grade.toLowerCase()}`;
}

["cleanliness", "handling", "efficiency"].forEach(id => {
  document.getElementById(id).addEventListener("input", updateGrade);
});

  window.submitData = async () => {
    const c = Number(cleanliness.value) / 100;
    const h = Number(handling.value) / 100;
    const e = Number(efficiency.value) / 100;

    await update(ref(db, `stalls/${stallName}`), {
      cleanliness: c,
      handling: h,
      efficiency: e,
      lastUpdated: new Date().toISOString()
    });
    window.location.href = "Inspection results history Jan 2026.html";
  };
</script>

</body>
</html>