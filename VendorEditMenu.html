<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ShiokLah!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kodchasan:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="Vendor.css" />
    <style>
    /* ====== PAGE LAYOUT ====== */

.page-header {
  background: transparent;              /* was #ffdfae */
  box-shadow: 0 4px 12px rgba(16,24,40,.06);  /* less shadow */
  border-radius: 16px;
  padding: 16px 18px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 14px;
}

.title-block h1 {
  font-size: 22px;
  margin: 0;
  font-weight: 600;     /* was 800 */
  color: #000000;
}

.cuisine-dropdown {
  display: flex;
  align-items: center;
  gap: 10px;
}

.cuisine-dropdown select {
  height: 40px;
  border-radius: 12px;
  border: 1px solid #7f848d;
  padding: 0 12px;
  font-weight: 500;
}

.add-btn {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  border: none;
  background: #ff8c3a;
  display: grid;
  place-items: center;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(255,140,58,.25);
  transition: transform .08s ease;
}
.add-btn:active { transform: scale(.98); }
.add-btn img { width: 18px; height: 18px; filter: brightness(0) invert(1); }

/* ====== TABLE HEADER + LIST ====== */
.menu {
  margin-top: 16px;
  background: #fff;
  border-radius: 16px;
  border: 1px solid #eceff5;
  box-shadow: 0 10px 28px rgba(16,24,40,.08);
  overflow: hidden;
}

.table-header {
  display: grid;
  grid-template-columns: 90px 1.6fr 110px 160px;
  gap: 12px;
  align-items: center;
  padding: 14px 16px;
  background: #fff7ef;
  border-bottom: 1px solid #eceff5;
  color: #000;          /* was #344054 */
  font-weight: 700; 
}

.menu-list {
  display: grid;
  gap: 0;
}

/* ====== MENU ROW (CARD-LIKE) ====== */
.menu-card {
  display: grid;
  grid-template-columns: 90px 1.6fr 110px 160px;
  gap: 12px;
  align-items: center;
  object-fit: contain; 
  padding: 14px 16px;
  border-bottom: 1px solid #eceff5;
  background: #FFDCC5;
}

.menu-card:nth-child(even) { background: #FFF0E6; }
.menu-card:last-child { border-bottom: none; }

.menu-card img {
  width: 74px;
  height: 74px;
  border-radius: 12px;
  object-fit: cover;
  border: 1px solid #eceff5;
}

.item-name {
  font-size: 16px;
  font-weight: 900;
  color: #101828;
  line-height: 1.2;
}

.item-desc {
  margin-top: 6px;
  font-size: 13px;
  color: #667085;
  font-weight: 600;
  max-width: 520px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.price {
  font-size: 13px;
  font-weight: 600;
  color: #101828;
}

/* ====== ACTIONS ====== */
.actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.icon-btn {
  display: grid;
  place-items: center;
  cursor: pointer;
  border-radius: 14px;
  overflow: hidden;
  background-color: white;
  border: 1px solid #eceff5;
  transition: transform .08s ease, background .15s ease;
}
.icon-btn:hover { background: #f7f8fb; }
.icon-btn:active { transform: scale(.98); }
.icon-btn img { width: 22px; height: 22px;object-fit: contain;display: block; }

/* ====== MODAL FORM ====== */
.modal {
  position: fixed;
  inset: 0;
  display: none;
  z-index: 3000;
}
.modal.show { display: block; }

.modal-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.35);
}

.menu-form {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: min(980px, 94vw);      /* bigger than 860px */
  max-height: 86vh;             /* prevents going off-screen */
  overflow: auto;               /* scroll inside if needed */
  padding: 22px; 
  background: #fff;
  padding: 18px;
  border-radius: 16px;
  box-shadow: 0 20px 50px rgba(0,0,0,.20);
}
.modal-grid{
  display: grid;
  grid-template-columns: 1.15fr 0.85fr; /* left bigger */
  gap: 18px;
  margin-top: 12px;
  align-items: start;
}
.modal-left label,
.modal-right label{
  display: block;
  margin-top: 12px;
  font-weight: 700; /* lower than 800 */
  color: #344054;
  font-size: 13px;
}
.modal-left label:first-child,
.modal-right label:first-child{
  margin-top: 0;
}
.menu-form h2{
  margin: 0 0 10px;
  font-size: 18px;
  font-weight: 900;
  color: #344054;
}

.menu-form label {
  display: block;
  margin-top: 12px;
  font-weight: 800;
  color: #344054;
  font-size: 13px;
}

.menu-form input,
.menu-form textarea {
  width: 100%;
  margin-top: 6px;
  border-radius: 12px;
  border: 1px solid #e8ecf3;
  padding: 10px 12px;
  font-size: 14px;
  outline: none;
}
.menu-form input:focus,
.menu-form textarea:focus {
  border-color: rgba(255,140,58,.55);
  box-shadow: 0 0 0 4px rgba(255,140,58,.25);
}

.form-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 14px;
}

.confirm-btn, .cancel-btn {
  height: 40px;
  padding: 0 14px;
  border-radius: 12px;
  font-weight: 900;
  border: none;
  cursor: pointer;
}

.confirm-btn { background: #ff8c3a; color: #fff; }
.cancel-btn { background: #fff; color: #344054; border: 1px solid #e8ecf3; }

/* ====== RESPONSIVE ====== */
@media (max-width: 720px){
  .menu-form{
    width: min(560px, 94vw);
    max-height: 90vh;
  }
  .image-picker{
    height: 220px;
  }
  .page-header{
    flex-direction: column;
    align-items: flex-start;
  }

  .table-header { display: none; }

  .modal-grid{
    grid-template-columns: 1fr;
  }

  .menu-card{
    grid-template-columns: 90px 1fr;
    grid-template-areas:
      "img name"
      "img price"
      "actions actions";
    row-gap: 8px;
  }

  .menu-card img { grid-area: img; }
  .menu-card .name-wrap { grid-area: name; }
  .menu-card .price { grid-area: price; }
  .menu-card .actions { grid-area: actions; justify-content: flex-start; }
}
.create-btn {
  width:36px;
  height:36px;
  border-radius:10px;
  border:none;
  background:#ff8c3a;
  color:white;
  font-size:20px;
  font-weight:700;
  cursor:pointer;
}

.create-btn:hover {
  opacity: 0.92;
}
/* Make the header row behave like agreements-header */
.page-header .header-row {
  display: flex;
  align-items: center;
  justify-content: space-between; /* title left, controls right */
  width: 100%;
  gap: 14px;
}

/* This is your agreements-actions */
.page-header .cuisine-dropdown {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 12px;
}

/* This replaces .status-filter */
.page-header .cuisine-dropdown select {
  height: 42px;                 /* match create button height */
  padding: 0 14px;
  border-radius: 12px;
  border: 1px solid rgba(0, 0, 0, 0.12);
  background: #fff;
  font-size: 14px;
  outline: none;
}
.image-preview {
  object-fit: cover;
  display: none;
  margin-top: 10px;
  width: 100%;
  max-height: 220px;
  height: 100%;
  object-fit: cover;
  border-radius: 12px;
  border: 1px solid #e8ecf3;
  display: none;
}

.image-picker{
  margin-top: 8px;
  width: 100%;
  height: 360px;  
  border-radius: 12px;
  border: 1px dashed #cfd6e4;
  display: grid;
  place-items: center;
  cursor: pointer;
  background: #fafbff;
  overflow: hidden;
}

.image-hint{
  font-size: 13px;
  font-weight: 600;
  color: #667085;
  padding: 0 10px;
  text-align: center;
  padding: 0 10px;
}
.image-meta{
  margin-top: 10px;
  font-size: 12px;
  color: #667085;
  font-weight: 600;
}
.remove-image-btn{
  margin-top: 10px;
  height: 40px;
  width: 100%;
  border-radius: 12px;
  border: 1px solid #e8ecf3;
  background: #fff;
  font-weight: 700;
  cursor: pointer;
}
.remove-image-btn:hover{
  background: #f7f8fb;
}
.menu-card.is-hidden {
  opacity: 0.55;
  filter: grayscale(0.2);
}


    </style>
  </head>
  <body>
    <!-- Vendor Home -->
     <section class="container vendornav">
      <nav class="navrectangle">
        <header class="brand">ShiokLah!</header>

        <ul class="navBar">
          <li>
            <a href="PerformanceDashboard.html" class="main toggle">
              üè† Dashboard
            </a>
          </li>

          <!-- <li class="divider"></li> -->

           <li>
            <a href="VendorEditMenu.html" class="main toggle">
              üçΩÔ∏è Edit Menu
            </a>
          </li>

          <!-- <li class="divider"></li> -->

          <li class="main toggle ven-profile">
            <span>üë§ Profile</span>
            <span class="usernameDisplay"></span>
            <span class="arrow">v</span>
          </li>
          <ul class="submenu">
            <li>
              <button onclick="window.location.href='StallHygieneGrades.html';" class="subpoint">
               ‚Ä¢ Stall Hygiene Grades
              </button>
            </li>
            <li>
             <button onclick="window.location.href='FED_ASG.html';" class="subpoint">
               ‚Ä¢ Performance Dashboard
              </button>
            </li>
            <li>
              <button onclick="window.location.href='RentalAgreement.html';" class="subpoint">
              ‚Ä¢ My Rental Agreements
              </button>
            </li>

            <li>
            <button onclick="window.location.href='CustomerFeedBack.html';" class="subpoint">
              ‚Ä¢ Customer Feedback
              </button>
            </li>
            <li class="subpoint settings">‚Ä¢ Settings</li>
          </ul>

          <!-- <li class="divider"></li> -->
          <li class="subpoint logout">Log out</li>
        </ul>
      </nav>

      <nav class="mobile-nav vendornav">
        <div class="mobile-nav-item active" data-link="PerformanceDashboard.html">
          <span>üè†</span>
          <small>Home</small>
        </div>

        <div class="mobile-nav-item" data-link="VendorEditMenu.html">
          <span>üçΩÔ∏è</span>
          <small>Edit Menu</small>
        </div>

        <div class="mobile-nav-item" data-link="VendorProfile.html">
          <span>üë§</span>
          <small>Profile</small>
        </div>
      </nav>
    <!--Contents-->
  <main class="contents">
    <header class="page-header">
      <div class="header-row">
        <div class="title-block">
          <h1>Edit Menu</h1>
          <!-- <div class="divider"></div> -->
        </div>
        <div class="cuisine-dropdown">
      <select id="cuisineSelect">
      <option value="" disabled selected>Select specialized cuisine</option>
      <option value="Malay">Malay</option>
      <option value="Chinese">Chinese</option>
      <option value="Indian">Indian</option>
      <option value="Others">Others</option>
    </select>
     <button id="addBtn" class="create-btn" type="button" type="button">+</button>
    </div>
  </div>
      </div>
    </header>

<div class="modal" id="menuModal">
  <div class="modal-overlay" id="menuOverlay"></div>

  <form class="menu-form" id="menuForm">
    <h2 id="formTitle">Add Menu Item</h2>

    <div class="modal-grid">
      <!-- LEFT -->
      <div class="modal-left">
        <label>Item:</label>
        <input type="text" class="itemName" id="itemName" placeholder="Enter menu item" required>

        <label>Price:</label>
        <input type="number" class="price" id="itemPrice" placeholder="Enter price" step="0.01" required>

        <label>EWT (mins):</label>
        <input type="number" class="ewt" id="itemEWT" placeholder="Enter estimated waiting time">

        <label>Description:</label>
        <textarea class="description" id="itemDesc" rows="4" placeholder="Enter a description of your food"></textarea>
      </div>

      <!-- RIGHT -->
      <div class="modal-right">
  <label>Upload Image:</label>


  <div id="imagePicker" class="image-picker" role="button" tabindex="0">
    <img id="imagePreview" class="image-preview" alt="Image preview" />
    <div id="imageHint" class="image-hint">Image Preview</div>
  </div>
  
  <label style="margin-top:12px;">Image filename (saved in images/menu/)</label>
  <label style="margin-top:12px;">Select image</label>

<select id="imageSelect"
  style="margin-top:6px; width:100%; padding:10px 12px;
         border-radius:12px; border:1px solid #e8ecf3;">
  <option value="">No image (use placeholder)</option>

    <!-- ‚úÖ List images that exist in /images/ -->
    <option value="Set Meal A Picture.jpg">Set Meal A</option>
    <option value="Set Meal B Picture.jpg">Set Meal B</option>
    <option value="Set Meal C Picture.png">Set Meal C</option>
    <option value="Set Meal D Picture.jpg">Set Meal D</option>
    <option value="Otah Picture.webp">Otah</option>
    <option value="malaysiacurry.jpg">Malaysia Curry</option>
    <option value="meebakso.jpg">Mee Bakso</option>
    <option value="nasi-sambal-goreng-daging.jpg">Nasi Sambal Goreng Daging</option>
    <option value="nasilemak.jpg">Original Nasi Lemak</option>
    <option value="rendangayam.webp">Rendangayam</option>
  </select>

  <div class="image-meta">
    <b>Select</b> an image to upload
  </div>

  <button type="button" id="removeImageBtn" class="remove-image-btn" style="display:none;">
    Remove image
  </button>
</div>
    </div>

    <div class="form-buttons">
      <button type="button" class="cancel-btn" id="cancelModal">Cancel</button>
      <button type="submit" class="confirm-btn">Confirm</button>
    </div>
  </form>
</div>

  <section class="menu">
  <div class="table-header">
    <span>Image</span>
    <span>Item</span>
    <span>Price</span>
    <span style="text-align:right;">Actions</span>
  </div>

  <div class="menu-list" id="menuList">

    <div class="menu-card">
      <img src="images/Set Meal A Picture.jpg" alt="Set Meal A" />
      <div class="name-wrap">
        <div class="item-name">Set Meal A</div>
        <div class="item-desc">Optional description appears here (nice on desktop)</div>
      </div>
      <div class="price">$5.00</div>

      <div class="actions">
        <button class="icon-btn" type="button" title="Edit">
          <img src="images/edit.png" alt="Edit">
        </button>
        <button class="icon-btn" type="button" title="Delete">
          <img src="images/delete.png" alt="Delete">
        </button>
        <button class="icon-btn" type="button" title="View">
          <img src="images/view.png" alt="View">
        </button>
      </div>
    </div>

  </div>
</section>

    </section>

  </main>
<script type="module">
  import { getDatabase, ref, get, update, onValue,remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
const firebaseConfig = {
    apiKey: "AIzaSyCoYoGP4NYJPHqA-kV_swajQ4LSQYdyWV4",
    authDomain: "grp3fedapp.firebaseapp.com",
    databaseURL: "https://grp3fedapp-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "grp3fedapp",
    storageBucket: "grp3fedapp.firebasestorage.app",
    messagingSenderId: "791146838729",
    appId: "1:791146838729:web:446baee191feeb036e2b18",
  };
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let editMode = false;
let editingItemKey = null; // firebase key of the item we're editing

function renderVendorMenu(menuItems) {
  const list = document.getElementById("menuList");
  if (!list) return;

  list.innerHTML = "";

  if (!menuItems) {
    list.innerHTML = "<p style='padding:16px;'>No menu items found.</p>";
    return;
  }

  Object.entries(menuItems)
  .sort(([, a], [, b]) => {
    // visible items first, hidden items last
    return (a.available === false) - (b.available === false);
  })
  .forEach(([itemKey, item]) => {

    // itemKey is the Firebase key (safeKey already)
    const displayName = item.displayName || itemKey;

    const card = document.createElement("div");
    card.className = "menu-card";

    card.innerHTML = `
      <img src="${item.image || "images/placeholder.jpg"}" alt="${displayName}">
      <div class="name-wrap">
        <div class="item-name">${displayName}</div>
        <div class="item-desc">${item.description || ""}</div>
      </div>
      <div class="price">$${Number(item.price || 0).toFixed(2)}</div>

      <div class="actions">
        <button class="icon-btn edit-btn" type="button" title="Edit">
          <img src="images/edit.png" alt="Edit">
        </button>

        <button class="icon-btn vis-btn" type="button"
          title="${item.available === false ? "Show" : "Hide"}">
          <img
            src="images/${item.available === false ? "view.png" : "visible.png"}"
            alt="Visibility">
        </button>


        <button class="icon-btn delete-btn" type="button" title="Delete">
          <img src="images/delete.png" alt="Delete">
        </button>
      </div>
    `;

    // Grey out hidden items
    if (item.available === false) card.classList.add("is-hidden");

    // Delete
    card.querySelector(".delete-btn").addEventListener("click", () => {
      deleteMenuItem(stallName, itemKey); // use the key, not the display name
    });

    // Toggle visibility (soft delete)
    const visBtn = card.querySelector(".vis-btn");
    const visImg = visBtn.querySelector("img");

    visBtn.addEventListener("click", async () => {
      const isCurrentlyAvailable = item.available !== false;

      await toggleMenuItemAvailability(stallName, itemKey, isCurrentlyAvailable);

      // Optimistic UI update (instant feedback)
      item.available = !isCurrentlyAvailable;

      visImg.src = `images/${item.available ? "view.png" : "visible.png"}`;
      visBtn.title = item.available ? "Hide" : "Show";

      card.classList.toggle("is-hidden", !item.available);
    });


      // Edit
      card.querySelector(".edit-btn").addEventListener("click", () => {
        setFormModeEdit(itemKey, item);
        openModal();
      });

    list.appendChild(card);
  });
}


// Banana Leaf Nasi Lemak Menu
const stallName = "Banana Leaf Nasi Lemak";
const menuRef = ref(db, `stalls/${stallName}/menuItems`);

onValue(menuRef, (snap) => {
  renderVendorMenu(snap.val());
});

const cuisineSelect = document.getElementById("cuisineSelect");

// A small helper for UI feedback (optional)
function setCuisineStatus(text) {
  console.log(text);
}

// 1) Load current cuisine and reflect in dropdown (realtime)
const stallRef = ref(db, `stalls/${stallName}`);
onValue(stallRef, (snap) => {
  if (!snap.exists()) {
    setCuisineStatus("Stall not found.");
    return;
  }

  const stall = snap.val();
  if (cuisineSelect && stall.cuisine) {
    cuisineSelect.value = stall.cuisine; // sets dropdown to current cuisine
  }
});

// 2) Update cuisine when user changes dropdown
if (cuisineSelect) {
  cuisineSelect.addEventListener("change", async () => {
    const newCuisine = cuisineSelect.value;

    if (!newCuisine) return;

    try {
      await update(ref(db, `stalls/${stallName}`), {
        cuisine: newCuisine,
        cuisineUpdatedAt: Date.now(),
      });

      setCuisineStatus(`Cuisine updated to: ${newCuisine}`);
    } catch (err) {
      console.error(err);
      setCuisineStatus("Failed to update cuisine.");
    }
  });
}
// ==== ADD MENU ITEM & UPLOAD IMAGE INTO FIREBASE ==== //
 const menuForm = document.getElementById("menuForm");

function safeKey(str) {
  return (str || "").trim().replace(/[.#$[\]/]/g, "_");
}

if (!menuForm) console.error("menuForm not found!");
else {
menuForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const itemName = document.getElementById("itemName").value.trim();
  const price = Number(document.getElementById("itemPrice").value);
  const ewt = Number(document.getElementById("itemEWT").value || 0);
  const description = document.getElementById("itemDesc").value.trim() || "";

  const imgSelect = document.getElementById("imageSelect");
  const imgName = imgSelect ? imgSelect.value : "";

  if (!itemName || !Number.isFinite(price)) {
    alert("Please fill in item name and valid price.");
    return;
  }

  const imageUrl = imgName ? `images/${imgName}` : "images/placeholder.jpg";
  const newKey = safeKey(itemName);

  try {
    if (!editMode) {
      // ===== ADD MODE =====
      await update(ref(db, `stalls/${stallName}/menuItems/${newKey}`), {
        displayName: itemName,
        price,
        ewt,
        description,
        available: true,
        image: imageUrl,
        updatedAt: Date.now(),
      });

      alert("‚úÖ Menu item added!");
    } else {
      // ===== EDIT MODE =====
      const oldKey = editingItemKey;

      if (!oldKey) {
        alert("‚ùå No item selected to edit.");
        return;
      }

      if (newKey !== oldKey) {
        // Rename key: create new node then delete old node
        await update(ref(db, `stalls/${stallName}/menuItems/${newKey}`), {
          ...(await (async () => {
            // keep available flag if it exists
            const snap = await get(ref(db, `stalls/${stallName}/menuItems/${oldKey}`));
            const oldItem = snap.exists() ? snap.val() : {};
            return { available: oldItem.available !== false };
          })()),
          displayName: itemName,
          price,
          ewt,
          description,
          image: imageUrl,
          updatedAt: Date.now(),
        });

        await remove(ref(db, `stalls/${stallName}/menuItems/${oldKey}`));
      } else {
        // Same key, just update fields
        await update(ref(db, `stalls/${stallName}/menuItems/${oldKey}`), {
          displayName: itemName,
          price,
          ewt,
          description,
          image: imageUrl,
          updatedAt: Date.now(),
        });
      }

      alert("‚úÖ Menu item updated!");
    }

    // reset + close
    menuForm.reset();
    if (typeof clearImage === "function") clearImage();
    setFormModeAdd();
    closeModal();
  } catch (err) {
    console.error(err);
    alert("‚ùå Failed to save changes.");
  }
});
}

 // ===== MODAL =====
const addBtn = document.getElementById("addBtn");
const modal = document.getElementById("menuModal");
const overlay = document.getElementById("menuOverlay");
const cancelBtn = document.getElementById("cancelModal");

function openModal() {
  if (!modal) return;
  modal.classList.add("show");
  document.body.style.overflow = "hidden";
}

function closeModal() {
  if (!modal) return;
  modal.classList.remove("show");
  document.body.style.overflow = "";
}

// open ADD mode
if (addBtn) {
  addBtn.addEventListener("click", () => {
    setFormModeAdd();
    openModal();
  });
}

// close
if (overlay) overlay.addEventListener("click", () => {
  setFormModeAdd();
  closeModal();
});
if (cancelBtn) cancelBtn.addEventListener("click", () => {
  setFormModeAdd();
  closeModal();
});


function setFormModeAdd() {
  editMode = false;
  editingItemKey = null;
  const title = document.getElementById("formTitle");
  if (title) title.textContent = "Add Menu Item";
}

function setFormModeEdit(itemKey, item) {
  editMode = true;
  editingItemKey = itemKey;

  const title = document.getElementById("formTitle");
  if (title) title.textContent = "Edit Menu Item";

  // Prefill fields
  document.getElementById("itemName").value = item.displayName || itemKey;
  document.getElementById("itemPrice").value = item.price ?? "";
  document.getElementById("itemEWT").value = item.ewt ?? "";
  document.getElementById("itemDesc").value = item.description || "";

  // Prefill image dropdown
  const img = item.image || "";
  const fileOnly = img.startsWith("images/") ? img.replace("images/", "") : "";
  if (imageSelect) imageSelect.value = fileOnly || "";

  // Preview
  if (item.image) {
    previewImg.src = item.image;
    previewImg.style.display = "block";
    if (hint) hint.style.display = "none";
    showRemoveBtn(true);
  } else {
    clearImage();
  }
}

// ===== IMAGE SELECT -> PREVIEW =====
const previewImg = document.getElementById("imagePreview");
const hint = document.getElementById("imageHint");
const removeImageBtn = document.getElementById("removeImageBtn");

function showRemoveBtn(show) {
  if (!removeImageBtn) return;
  removeImageBtn.style.display = show ? "block" : "none";
}

function clearImage() {
  if (previewImg) {
    previewImg.src = "";
    previewImg.style.display = "none";
  }
  if (hint) hint.style.display = "block";
  showRemoveBtn(false);
  if (imageSelect) imageSelect.value = "";
}

if (imageSelect) {
  imageSelect.addEventListener("change", () => {
    const file = imageSelect.value;

    if (!file) {
      clearImage();
      return;
    }

    if (previewImg) {
      previewImg.src = `images/${file}`;
      previewImg.style.display = "block";
    }
    if (hint) hint.style.display = "none";
    showRemoveBtn(true);
  });
}

// remove image button
if (removeImageBtn) {
  removeImageBtn.addEventListener("click", clearImage);
}

//Delete menu item
async function deleteMenuItem(stallName, itemKey) {
  const confirmed = confirm(`Delete "${itemKey}"?\nThis cannot be undone.`);
  if (!confirmed) return;

  try {
    await remove(ref(db, `stalls/${stallName}/menuItems/${itemKey}`));
    alert(`üóëÔ∏è "${itemKey}" deleted`);
  } catch (err) {
    console.error(err);
    alert("‚ùå Failed to delete menu item");
  }
}

async function toggleMenuItemAvailability(stallName, itemKey, currentAvailable) {
  try {
    await update(ref(db, `stalls/${stallName}/menuItems/${itemKey}`), {
      available: !currentAvailable,
      updatedAt: Date.now(),
    });
  } catch (err) {
    console.error(err);
    alert("‚ùå Failed to update visibility.");
  }
}
</script>
  </body>
</html>
